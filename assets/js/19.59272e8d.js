(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{346:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"tcp-粘包和拆包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp-粘包和拆包"}},[t._v("#")]),t._v(" TCP 粘包和拆包")]),t._v(" "),s("blockquote",[s("p",[t._v("TCP是一种面向连接的、可靠的、基于字节流的传输协议。其可能产生粘包和拆包问题。")])]),t._v(" "),s("h3",{attrs:{id:"什么是粘包和拆包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是粘包和拆包"}},[t._v("#")]),t._v(" 什么是粘包和拆包")]),t._v(" "),s("ul",[s("li",[t._v("TCP 粘包是指接收方在一次接收中收到了发送方多次发送的数据。如发送方分两次发送了"),s("code",[t._v("Hello")]),t._v(" 和 "),s("code",[t._v("World")]),t._v(", 接收方一次接收到"),s("code",[t._v("HelloWorld")]),t._v("。")]),t._v(" "),s("li",[t._v("TCP 拆包是指发送方发送一次数据，接收方一次只接收部分数据。如发送方分两次发送了"),s("code",[t._v("HelloWorld")]),t._v(", 接收方分多次接收到"),s("code",[t._v("Hello")]),t._v(" 和 "),s("code",[t._v("World")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"粘包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#粘包"}},[t._v("#")]),t._v(" 粘包")]),t._v(" "),s("h4",{attrs:{id:"产生原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#产生原因"}},[t._v("#")]),t._v(" 产生原因")]),t._v(" "),s("p",[t._v("为了提高传输效率和减少网络流量，TCP会使用"),s("a",{attrs:{href:"https://baike.baidu.com/item/%E7%BA%B3%E6%A0%BC%E7%AE%97%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nagle算法"),s("OutboundLink")],1),t._v("将短时间内接收、发送的多个小数据块合并成一个大数据块放在缓存中，接收端从缓存中取到了连续的多个数据块，这些数据块之间没有边界，无法将这些数据还原。")]),t._v(" "),s("h4",{attrs:{id:"示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),s("p",[t._v("server.py")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" socket\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\nhost "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\nport "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("\n\ns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AF_INET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SOCK_STREAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("listen"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accept"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndata1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndata2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data1: '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data2: '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("client.py")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" socket\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\nhost "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\nport "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("\n\ns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AF_INET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SOCK_STREAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"python3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),s("p",[t._v("打开两个 Terminal，一个运行"),s("code",[t._v("python3 server.py")]),t._v("，另一个运行"),s("code",[t._v("python3 client.py")]),t._v("，第一个终端将输出：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bing@GH-HT6M693:~$ python3 server.py\ndata1:  hellopython3\ndata2:\n")])])]),s("p",[t._v("如果同时使用 tcpdump 监视网络流量，输出如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("root@GH-HT6M693:~"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tcpdump -i lo 'port 8090'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.371499 IP localhost.60048 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2472192704")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65495")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mss "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65495")]),t._v(",sackOK,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",nop,wscale "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.371505 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.60048: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3673077898")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2472192705")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65483")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mss "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65495")]),t._v(",sackOK,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(",nop,wscale "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.371511 IP localhost.60048 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.371538 IP localhost.60048 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("P."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":6, ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.371540 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.60048: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.371544 IP localhost.60048 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("P."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(":13, ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.371545 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.60048: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.372139 IP localhost.60048 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("F."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690722")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690721")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.373304 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.60048: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("F."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690723")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690722")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v(":33:28.373312 IP localhost.60048 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690723")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4195690723")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[t._v("可见 60048 端口向 8090 端口发送了两次请求，长度分别是 5 和 7，对应的数据分别是 "),s("code",[t._v("hello")]),t._v(" 和 "),s("code",[t._v("python3")]),t._v("，但接收方收到的数据是"),s("code",[t._v("hellopython3")]),t._v("，出现了粘包。")]),t._v(" "),s("h3",{attrs:{id:"拆包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拆包"}},[t._v("#")]),t._v(" 拆包")]),t._v(" "),s("h4",{attrs:{id:"产生原因-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#产生原因-2"}},[t._v("#")]),t._v(" 产生原因")]),t._v(" "),s("p",[t._v("发送方一次发送的数据量超过了 "),s("a",{attrs:{href:"#mss"}},[t._v("MSS")]),t._v(" 的大小，将会被拆分成多个TCP报文发送。")]),t._v(" "),s("h4",{attrs:{id:"示例-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例-2"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),s("p",[t._v("server.py")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" socket\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\nhost "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\nport "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("\n\ns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AF_INET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SOCK_STREAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("listen"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accept"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接收大于 MTU 的数据量")]),t._v("\ndata1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndata2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data1: '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data2: '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("client.py")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" socket\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\nhost "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\nport "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("\n\ns "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AF_INET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SOCK_STREAM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmsg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    msg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'python3'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 发送大于 MTU 的数据量")]),t._v("\ns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("send"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("打开两个 Terminal，一个运行"),s("code",[t._v("python3 server.py")]),t._v("，另一个运行"),s("code",[t._v("python3 client.py")]),t._v("，第一个终端将输出：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bing@GH-HT6M693:~$ python3 server.py\ndata1:  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("70000")]),t._v("\ndata2:  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[t._v("如果同时使用 tcpdump 监视网络流量，输出如下：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("root@GH-HT6M693:~"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tcpdump -i lo 'port 8090'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.026845 IP localhost.44340 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2339273820")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65495")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mss "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65495")]),t._v(",sackOK,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390377")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(",nop,wscale "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.026852 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.44340: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3182816013")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2339273821")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65483")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mss "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65495")]),t._v(",sackOK,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390377")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390377")]),t._v(",nop,wscale "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.026857 IP localhost.44340 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390377")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390377")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.028102 IP localhost.44340 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":32742, ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390377")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32741")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.028118 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.44340: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32742")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("380")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.028127 IP localhost.44340 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("P."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32742")]),t._v(":65483, ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390377")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32741")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.028132 IP localhost.44340 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("P."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65483")]),t._v(":70001, ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4518")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.028220 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.44340: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("70001")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.028916 IP localhost.44340 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("F."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("70001")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390379")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390378")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.030105 IP localhost.8090 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.44340: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("F."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seq")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("70002")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390380")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390379")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(":01:48.030111 IP localhost.44340 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" localhost.8090: Flags "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", ack "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(", win "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(", options "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nop,nop,TS val "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390380")]),t._v(" ecr "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4197390380")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(", length "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[t._v("可见 44340 端口向 8090 端口发送了三次数据，长度分别是 32741、32741 和 4518，出现了拆包。")]),t._v(" "),s("p",[t._v("此处尚有疑问：为何三次数据的总长度不等于接收到的数据长度？")]),t._v(" "),s("h3",{attrs:{id:"其他概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他概念"}},[t._v("#")]),t._v(" 其他概念")]),t._v(" "),s("h4",{attrs:{id:"mss"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mss"}},[t._v("#")]),t._v(" MSS")]),t._v(" "),s("p",[t._v("是指 TCP 连接建立后双方约定的可传输的最大报文长度，它的值需通过 MTU 计算，计算公式为 MSS = MTU - 20(IP Header) - 20(TCP Header)")]),t._v(" "),s("p",[t._v("MTU 可以通过 "),s("code",[t._v("ip")]),t._v(" 命令查看：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bing@GH-HT6M693:~$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" a\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(": lo: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("LOOPBACK,UP,LOWER_UP"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mtu "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65536")]),t._v(" qdisc noqueue state UNKNOWN group default qlen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1/8 scope "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v("\n       valid_lft forever preferred_lft forever\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(": eth0: "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("BROADCAST,MULTICAST,UP,LOWER_UP"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" mtu "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1500")]),t._v(" qdisc mq state UP group default qlen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    link/ether 00:15:5d:e3:0f:de brd ff:ff:ff:ff:ff:ff\n    inet "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.22")]),t._v(".214.60/20 brd "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.22")]),t._v(".223.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::215:5dff:fee3:fde/64 scope "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),t._v("\n       valid_lft forever preferred_lft forever\n")])])]),s("p",[t._v("如上，"),s("code",[t._v("lo")]),t._v(" 网卡的 MSS = 65536 - 20 - 20 = 65496")])])}),[],!1,null,null,null);s.default=e.exports}}]);